package com.example.demo1;

import javafx.fxml.FXML;
import javafx.scene.control.Button;
import javafx.scene.control.Label;
import javafx.scene.image.ImageView;
import javafx.scene.layout.GridPane;

import java.util.Random;

public class HelloController {
    @FXML
    public ImageView player1;
    @FXML
    public ImageView player2;
    public GridPane grid;
    @FXML
    private Label welcomeText;
    @FXML
    private Button roll;
    @FXML
    private ImageView diceImage;
    @FXML
    private Button no;

    private Dice d = new Dice(diceImage, roll);
    private Board b = new Board();
    private boolean player1Turn = true, player2Turn = false;
    private boolean increaseCol1 = true, increaseCol2 = true;
    private int p1col = 0, p1row = 9;
    private int p2col = 0, p2row = 9;

    @FXML
    protected void onHelloButtonClick() {
        welcomeText.setText("Welcome to JavaFX Application!");
        String s = welcomeText.getText();
        System.out.println(s);
    }

    protected int RollDice() throws InterruptedException {
        /*roll.setDisable(true);
        d = new Dice(diceImage, roll);

        Thread thread = new Thread(d);
        thread.start();

        long start = System.currentTimeMillis();
        long end = start +1200; // 1.2 sec
        while(start < end) {
            start = System.currentTimeMillis();
        }
        System.out.println("DICE NO IS: "+d.getDiceNo());
        return d.getDiceNo();*/
        Random random = new Random();
        return random.nextInt(6)+1;
    }
    @FXML
    private void movePlayers() throws InterruptedException {
        int dice = RollDice();
        System.out.println("Dice gives: "+dice);
        if (player1Turn) {
            int[] t = changePos(p1col, p1row, dice, increaseCol1);
            p1col = t[0]; p1row = t[1];
            increaseCol1 = t[2] == 1;
            
            if (t[3] == 1) {        // Check win
                System.out.println("Player 1 won!");
                roll.setDisable(true);
            }
            
            GridPane.setConstraints(player1, p1col, p1row);
            changeTurn();
        }
        else if(player2Turn) {
            int[] t = changePos(p2col, p2row, dice, increaseCol2);
            p2col = t[0]; p2row = t[1];
            increaseCol2 = t[2] == 1;
            
            if (t[3] == 1) {    // Check win
                System.out.println("Player 2 won!");
                roll.setDisable(true);
            }
            
            GridPane.setConstraints(player2, p2col, p2row);
            changeTurn();
        }
    }

    private boolean checkWin(int col, int row) {
        return col == 0 && row == 0;
    }

    private int[] changePos(int col, int row, int dice, boolean increaseCol) {
        int[] temp = new int[4];    // col, row, increaseCol= T(1) or F(0), win= T(1) or F(0)
        temp[0] = col;
        temp[1] = row;

        if (increaseCol)
            col += dice;
        else
            col -= dice;

        if (col > 9) {
            increaseCol = false;
            row--;
            col = 9-(col -9)+1;
        }
        else if (col < 0) {
            increaseCol = true;
            col = -col -1;
            row--;
        }
        if (outsideBoundary(col, row)) {
            col = temp[0];
            row = temp[1];
            increaseCol = false;
        }

        if (checkWin(col, row))
            temp[3] = 1;

        temp[0] = col;
        temp[1] = row;
        if (increaseCol)
            temp[2] = 1;

        return temp;
    }

    private boolean outsideBoundary(int col, int row) {
        return row<0 || col<0;
    }

    private void changeTurn() {
        if (player1Turn) {
            player1Turn = false;
            player2Turn = true;
        }
        else if (player2Turn) {
            player1Turn = true;
            player2Turn = false;
        }
    }

    @FXML
    protected void printNo() {
        System.out.println("Dice No: "+d.getDiceNo());
    }
}